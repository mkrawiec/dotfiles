#!/usr/bin/env python3

import sys
import glob
import os
from configparser import RawConfigParser
from collections import defaultdict

def parse_file(filepath, files):
    parser = RawConfigParser()
    filename = os.path.basename(filepath)

    try:
        parser.read(filepath)
    except:
        return

    for section in parser.sections():
        files[filename][section] = dict(parser.items(section))

def dump_files(fh, files):
    for filename, sections in files.items():
        print('')
        print('# {}'.format(filename))
        for section, settings in sections.items():
            for key, setting in settings.items():
                print('kwriteconfig5 --file "{}" --group "{}" --key "{}" "{}"'
                        .format(filename, section, key, setting))

def main():
    files = defaultdict(dict)

    parse_file(sys.argv[1], files)

    dump_files('', files)

if __name__ == '__main__':
    main()
